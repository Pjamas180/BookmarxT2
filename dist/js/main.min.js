/*
 bookmarx 2016-06-02 
*/
function loadTemplate(a,b){templatesCache[a]?displayTemplate(templatesCache[a],b):$.get("/views/"+a+".ejs",function(c){templatesCache[a]=c,displayTemplate(c,b)})}function displayTemplate(a,b){var c=ejs.render(a,b);document.getElementById("display").innerHTML=c}function loadList(){var a=getUrlParameter("sort"),b=getUrlParameter("order"),c=getUrlParameter("tag"),d=getUrlParameter("search"),e="";a&&(e="?sort="+a+"&order="+b),d&&(e="?search="+d),c&&(e="?tag="+c),$.get("/api/bookmarks/"+e,function(a){loadTemplate("assignment2",{books:a})})}function getCSV(){console.log("clicked"),$.get("/api/bookmarks/",function(a){var b=JSON2CSV(a);console.log(b),window.open("data:text/csv;charset=utf-8,"+escape(b))})}function JSON2CSV(a){var b="object"!=typeof a?JSON.parse(a):a,c="",d="";console.log("my object: "+a),console.log(b);for(var e=0;e<b.length;e++){var d="",f=0;for(var g in b[e]){if(4==f){var h=b[e][g];h=h.replaceAll(",","&"),d+=h+","}else d+=b[e][g]+",";f+=1}f=0,d=d.slice(0,-1),c+=d+"\r\n"}return c}function handleFiles(a){console.log("files: "+a);var b=a[0];getAsText(b)}function getAsText(a){var b=new FileReader;b.readAsText(a),b.onload=loadHandler,b.onerror=errorHandler}function loadHandler(a){var b=a.target.result;processData(b)}function processData(a){for(var b=a.split(/\r\n|\n/),c=[],d=0;d<b.length;d++){for(var e=b[d].split(";"),f=[],g=0;g<e.length;g++)f.push(e[g]);c.push(f)}console.log(c);for(var d=0;d<c.length;d++){console.log("This is my: "+d+" time");for(var h in c[d])for(var i=c[d][h],j=i.split(","),g=0;g<j.length;g+=8)console.log("keywords: "+j[g+3]),$.ajax({url:"/api/bookmarks/",data:"title="+j[g+2]+"&url="+j[g+8]+"&keywords="+j[g+4].replaceAll("&",",")+"&description="+j[g+3]+"&star="+j[g+7],type:"POST",success:function(a){loadList()}})}}function errorHandler(a){"NotReadableError"==a.target.error.name&&alert("Canno't read file !")}function confirmDelete(a){var b=document.getElementById("title"+a).innerHTML,c=document.getElementById("url"+a).innerHTML,d=document.getElementById("keywords"+a).innerHTML,e={id:a,title:b,url:c,tags:d};loadTemplate("delete",{book:e})}function deleteBook(a){$.ajax({url:"/api/bookmarks/"+a,type:"DELETE",success:function(a){loadList()}})}function showAdd(){loadTemplate("add")}function addBook(){var a=document.getElementById("title"),b=document.getElementById("url"),c=document.getElementById("keywords"),d=document.getElementById("description"),e=document.getElementById("star");$.ajax({url:"/api/bookmarks/",data:"title="+a.value+"&url="+b.value+"&keywords="+c.value+"&description="+d.value+"&star="+e.value,type:"POST",success:function(a){loadList()}})}function showEdit(a){var b=document.getElementById("title"+a).innerHTML,c=document.getElementById("keywords"+a).innerHTML,d=document.getElementById("description"+a).innerHTML,e=document.getElementById("star"+a).innerHTML,f=document.getElementById("url"+a).innerHTML,g="",h="";console.log(c),"1"==e?g="selected":h="selected";var i={id:a,title:b,url:f,description:d,keywords:c,yes:g,star:e,no:h};loadTemplate("edit",{book:i})}function updateBook(a){var b=document.getElementById("edittitle"+a).value,c=document.getElementById("editstar"+a).value;console.log(c);var d=document.getElementById("editdescription"+a).value,e=document.getElementById("editkeywords"+a).value,f=document.getElementById("editurl"+a).value,b=document.getElementById("edittitle"+a).value;$.ajax({url:"/api/bookmarks/"+a,data:"title="+b+"&url="+f+"&keywords="+e+"&description="+d+"&star="+c,type:"PUT",success:function(a){loadList()}})}document.addEventListener("DOMContentLoaded",function(a){loadList()});var templatesCache=[],getUrlParameter=function(a){var b,c,d=decodeURIComponent(window.location.search.substring(1)),e=d.split("&");for(c=0;c<e.length;c++)if(b=e[c].split("="),b[0]===a)return void 0===b[1]?!0:b[1]};String.prototype.replaceAll=function(a,b,c){return this.replace(new RegExp(a.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),c?"gi":"g"),"string"==typeof b?b.replace(/\$/g,"$$$$"):b)};